<div class="container-fluid h-100">
  <div class="row h-100 flex-nowrap">
    <div class="col content py-1">
      <div class="my-2 d-flex">
        <app-students-search
          class="mr-auto"
          [rows]="rows"
          studentField="student"
          (searchResult)="onSelect($event)"
        ></app-students-search>
        <button class="btn mr-2 btn-secondary d-none d-lg-inline-block text-white" (click)="studentThesisTheme.onShow()">Тема диплому</button>
        <button class="btn mr-2 btn-warning d-none d-lg-inline-block text-white" (click)="synchronizeWithEdeboModal.onShow()">Синхронізувати з ЄДЕБО</button>
        <button class="btn btn-info d-none d-lg-inline-block" (click)="columnsModal.modal.show()">Вибір колонок</button>
        <button class="btn ml-2 btn-success d-none d-lg-inline-block" (click)="addStudentModal.modal.show()">Зарахувати</button>
        <button class="btn ml-2 d-inline-block d-lg-none" (click)="isSidebarOpen = !isSidebarOpen">Меню</button>
      </div>

      <ag-grid-angular
      class="ag-theme-balham students-table"
      [rowData]="rows"
      [columnDefs]="columnDefs"
      rowSelection="multiple"
      [accentedSort]="true"
      [localeText]="localeText"
      (selectionChanged)="onSelectionChanged($event)"
      (modelUpdated)="onModelUpdated($event)"
      [getRowNodeId]="getRowNodeId"
      (gridReady)="onGridReady($event)"
      >
      </ag-grid-angular>

      <div class="bg-light fixed-bottom p-3">
        Всього: {{count || '0'}}
      </div>
    </div>

    <app-sidebar class="{{isSidebarOpen ? 'sidebar open' : 'sidebar'}}">
      <div class="d-lg-none mb-3">
        <button class="btn btn-info" (click)="columnsModal.modal.show()">Вибір колонок</button>
        <button class="btn ml-2 btn-success" (click)="addStudentModal.modal.show()">Зарахувати</button>
        <button class="btn ml-auto close" (click)="isSidebarOpen = !isSidebarOpen">×</button>
      </div>
      <b class="mb-2">Фільтри:</b>
      <app-students-filters
        [groups]="groups"
        [students]="students"
        (applyFilters)="setRows($event)">
      </app-students-filters>
      <hr />
      <div *ngIf="selected.length === 1">
        <button
          class="btn btn-info w-100"
          (click)="personalInfoModal.openModal(selected[0]?.student?.id)"
        >
          Редагувати особисту інформацію
        </button>
        <button
          class="btn btn-info w-100 mt-3"
          (click)="degreeInfoModal.openModal(selected[0]?.student?.id)"
        >
          Редагувати навчальну інформацію
        </button>
        <button
          class="btn btn-info w-100 mt-3"
          (click)="academicVacationModal.openModal(selected[0]?.id)"
        >
          Направити в академ. відпустку
        </button>
      </div>
      <button
        *ngIf="selected.length"
        class="btn btn-info w-100 mt-3"
        (click)="studentExpelModal.openModal(selected)"
      >
        Відрахувати студентів
      </button>
      <button
        *ngIf="selected.length > 1"
        class="btn btn-success w-100 mt-3"
        (click)="assignStudentsToGroup.openModal(selected)">
        Призначити групу
      </button>
      <button
        *ngIf="selected.length > 1"
        class="btn btn-success w-100 mt-3"
        (click)="assignRecordBookNumberToStudents.openModal(selected)">
        Призначити номер заліковки
      </button>
    </app-sidebar>
  </div>
</div>

<app-students-columns
  #columnsModal
  (setColumns)="setColumns($event)">
</app-students-columns>
<student-thesis-theme-input #studentThesisTheme></student-thesis-theme-input>
<synchronize-with-edebo #synchronizeWithEdeboModal></synchronize-with-edebo>
<app-add-student
  #addStudentModal
  [groups]="groups"
  (onSubmit)="prependStudent($event)"
></app-add-student>

<app-student-expel
  (onSubmit)="onRemove($event)"
  #studentExpelModal
></app-student-expel>

<assign-record-book-number-to-students
  (onSubmit)="updateRecordBookNumber($event)"
  #assignRecordBookNumberToStudents
></assign-record-book-number-to-students>

<assign-students-to-group
  [groups]="groups"
  (onSubmit)="updateStudentsGroup($event)"
  #assignStudentsToGroup
></assign-students-to-group>

<app-student-personal-info
  (onSubmit)="updateStudentPersonalInfo($event)"
  #personalInfoModal
></app-student-personal-info>

<app-student-degree-info
  [groups]="groups"
  (onSubmit)="updateStudentDegreeInfo($event)"
  #degreeInfoModal
></app-student-degree-info>

<app-student-academic-vacation
  #academicVacationModal
  (onSubmit)="onRemove($event)"
></app-student-academic-vacation>
